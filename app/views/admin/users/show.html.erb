<div class="container">
  <%= link_to 'Back', admin_users_path %>
  <h1>User Profile</h1>
  <div>
    <p><strong>Email:</strong> <%= @user.email %></p>
    <p><strong>Login:</strong> <%= @user.login %></p>
    <p><strong>Name:</strong> <%= @user.name %></p>
    <p><strong>Surname:</strong> <%= @user.surname %></p>
    <p><strong>Date of Birth:</strong> <%= @user.date_of_birth %></p>
    <p><strong>Address:</strong> <%= @user.address %></p>
    <h4><strong>Orders:</strong></h4>

    <%= form_tag(admin_user_path, method: :get) do %>
      <%= label_tag(:start_date, "Start Date:") %>
      <%= date_field_tag(:start_date, params[:start_date]) %>

      <%= label_tag(:end_date, "End Date:") %>
      <%= date_field_tag(:end_date, params[:end_date]) %>

      <%= submit_tag("Search") %>
    <% end %>

    <div>
      <% Order.aasm.states.map(&:name).each do |status|%>
        <%= link_to status, url_for(params.to_unsafe_h.merge(status:)) %>
      <% end%>
    </div>
    <div>
      <%= link_to 'All' %>
    </div>
    <div>
      <p>Count: <%= @orders.count %></p>
      <p>Total amount: <%= @orders.amount_orders %></p>
      <%= paginate @paginate_orders %>
      <% if @paginate_orders.present? %>
        <% @paginate_orders.each do |order| %>
          Order ID: <%= order.id %>
          <div class="d-flex">
            <div>Order status:</div>
            <%= content_tag :span, class: "fw-bold #{color_status(order.status)}" do %>
              <%= order.status %>
            <% end %>
          </div>
          <ul>
            <% order.order_items.each do |item| %>
              <li><%= item.product.name %> - Quantity: <%= item.quantity %></li>
            <% end %>
          </ul>
          Ordered at <%= order.created_at.strftime('%Y-%m-%d, %H:%M') %>
          <% if order.received?%>
              <div class="d-flex">
                <div class='me-2'>Rating:</div>
                <div><%= order.rating ? order.rating : 'unrated' %></div>
              </div>
          <% end %>
          <div>
            Total value: <%= order.amount_order %>
          </div>
          <hr/>
        <% end %>
        <%= paginate @paginate_orders %>
      <% else %>
        <h4>Not yet</h4>
      <% end %>
    </div>
  </div>
</div>